<div class="body">
    <div class="container">
        <h2>Mis Ofertas</h2>
        <div class="create-offer-bar">
            <button class="btn-primary" (click)="openCreateModal()">Crear Oferta</button>
        </div>

        <div class="card-container">
            <div *ngFor="let oferta of ofertas" class="card">
                <div class="card-header">
                    <h3>{{ getProductoNombre(oferta.product_id) }}</h3>
                </div>
                <div class="card-body">
                    <p><strong>Cantidad:</strong> {{ oferta.cantidad }}</p>
                    <p><strong>Unidad de Medida:</strong> {{ getUnidadNombre(oferta.medida_unidades_id) }}</p>
                    <p><strong>Fecha de Inicio:</strong> {{ oferta.start_date }}</p>
                    <p><strong>Fecha de Fin:</strong> {{ oferta.end_date }}</p>
                    <p><strong>Contacto Visible:</strong> {{ oferta.contacto_visible ? 'Sí' : 'No' }}</p>
                </div>
                <div class="card-actions">
                    <button class="btn-secondary" (click)="openEditModal(oferta)">Editar</button>
                    <button class="btn-danger" (click)="openDeactivateModal(oferta)">Desactivar</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Create Modal -->
<div class="modal" id="createModal" *ngIf="createModalVisible">
    <div class="modal-content">
        <span class="close" (click)="closeCreateModal()">&times;</span>
        <h2>Crear Oferta</h2>
        <form (ngSubmit)="submitCreateForm()">
            <label>
                Producto:
                <select [(ngModel)]="newOferta.product_id" name="product_id" required>
                    <option *ngFor="let producto of productos" [value]="producto.idProducto">{{ producto.producto }}
                    </option>
                </select>
            </label>
            <label>
                Fecha de Inicio:
                <input type="date" [(ngModel)]="newOferta.start_date" name="start_date" required>
            </label>
            <label>
                Cantidad:
                <input type="number" [(ngModel)]="newOferta.cantidad" name="cantidad" required>
            </label>
            <label>
                Unidad de Medida:
                <select [(ngModel)]="newOferta.medida_unidades_id" name="medida_unidades_id" required>
                    <option *ngFor="let unidad of unidades" [value]="unidad.id">{{ unidad.unidad }}</option>
                </select>
            </label>
            <label>
                Contacto Visible:
                <input type="checkbox" [(ngModel)]="newOferta.contacto_visible" name="contacto_visible">
            </label>

            <button type="submit" class="action-btn create-btn">Crear</button>
        </form>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal" id="editModal" *ngIf="editModalVisible">
    <div class="modal-content">
        <span class="close" (click)="closeEditModal()">&times;</span>
        <h2>Editar Oferta</h2>
        <form (ngSubmit)="submitEditForm()">
            <label>
                Producto:
                <select [(ngModel)]="selectedOferta.product_id" name="product_id">
                    <option *ngFor="let producto of productos" [value]="producto.idProducto">{{ producto.producto }}
                    </option>
                </select>
            </label>
            <label>
                Fecha de Inicio:
                <input type="date" [(ngModel)]="selectedOferta.start_date" name="start_date">
            </label>
            <label>
                Cantidad:
                <input type="number" [(ngModel)]="selectedOferta.cantidad" name="cantidad">
            </label>
            <label>
                Unidad de Medida:
                <select [(ngModel)]="selectedOferta.medida_unidades_id" name="medida_unidades_id">
                    <option *ngFor="let unidad of unidades" [value]="unidad.id">{{ unidad.unidad }}</option>
                </select>
            </label>
            <label>
                Contacto Visible:
                <input type="checkbox" [(ngModel)]="selectedOferta.contacto_visible" name="contacto_visible">
            </label>
            <button type="submit" class="action-btn edit-btn">Guardar Cambios</button>
        </form>
    </div>
</div>

<!-- Deactivate Modal -->
<div class="modal" id="deactivateModal" *ngIf="deactivateModalVisible">
    <div class="modal-content">
        <span class="close" (click)="closeDeactivateModal()">&times;</span>
        <h2>Desactivar Oferta</h2>
        <p>¿Estás seguro de que deseas desactivar esta oferta?</p>
        <button class="action-btn deactivate-btn" (click)="deactivateOferta()">Desactivar</button>
        <button class="action-btn close-btn" (click)="closeDeactivateModal()">Cancelar</button>
    </div>
</div>